<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tip Calculator &mdash; Mobile Development with Scala</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Mobile Development with Scala" href="index.html" />
    <link rel="prev" title="Setting Up" href="setup.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="setup.html" title="Setting Up"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Mobile Development with Scala</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tip-calculator">
<h1><a class="toc-backref" href="#id1">Tip Calculator</a><a class="headerlink" href="#tip-calculator" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#tip-calculator" id="id1">Tip Calculator</a><ul>
<li><a class="reference internal" href="#feature-scenario" id="id2">Feature Scenario</a></li>
<li><a class="reference internal" href="#project-setup" id="id3">Project Setup</a></li>
<li><a class="reference internal" href="#creating-the-calculatorcore" id="id4">Creating the CalculatorCore</a></li>
<li><a class="reference internal" href="#designing-the-user-interface" id="id5">Designing the User Interface</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="feature-scenario">
<h2><a class="toc-backref" href="#id2">Feature Scenario</a><a class="headerlink" href="#feature-scenario" title="Permalink to this headline">¶</a></h2>
<div class="highlight-gerkin"><pre>Feature: Basic tip calculation
  Scenario: Calculate single check tip amount and total.
    Given that I want to calculate the amount of the tip
    When I enter $50 at 17% tip
    Then I should see $8.50 for the tip amount
    And $58.50 for the total amount</pre>
</div>
<p>I know this looks weird.  The format of this text is called Gerken.  This format is
used by business to describe a process they want to preform.</p>
</div>
<div class="section" id="project-setup">
<h2><a class="toc-backref" href="#id3">Project Setup</a><a class="headerlink" href="#project-setup" title="Permalink to this headline">¶</a></h2>
<p>To start the project we will use the gliter8 template that we installed in the setup chapter.
This command will ask a set of questions to setup the base of our project.  I have my answers to the
questions below. Anyting in square brackets are the default values in this template.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>~/bin/g8 jberkel/android-app
Template <span class="k">for </span>Android apps in Scala

package <span class="o">[</span>my.android.project<span class="o">]</span>: com.cajuncode.tipcalculator
name <span class="o">[</span>My Android Project<span class="o">]</span>: TipCalculator
main_activity <span class="o">[</span>MainActivity<span class="o">]</span>:
scala_version <span class="o">[</span>2.9.2<span class="o">]</span>: 2.10.0
api_level <span class="o">[</span>10<span class="o">]</span>:
useProguard <span class="o">[</span><span class="nb">true</span><span class="o">]</span>:
scalatest_version <span class="o">[</span>1.8<span class="o">]</span>: 1.9.1

Template applied in ./tip-calculator
</pre></div>
</div>
<p>The first thing we give the project is the package bundle identifier of the project.  You can change this at any time
untill you submit the app to the play store.  After that if you chnage this id it will be a new app and not an update.
Next is the name of the app.  Use Camel case for naming the project and all Class files.  Camel case is a naming
convention where each word in a name is capitalized and there is no space between words.  Next we need to name the
starting screen for the app. Personally I would use HomeActivity or MainActivity depending on how many Activities the
app will have. We will discusses activities in the next section as we start laying out the interface.  After we set the
activity we need to tell it what version of Scala we want to ues.  Then we select the Android API level we want to use.
This basicly is what version of android you are targeting with the application.  We want to use Proguard, it makes our
apps smaller by removing unsused classes.  Last is the version of Scalatest we are going to use to write our tests.</p>
<p>This creates a working project for us.</p>
<a class="reference internal image-reference" href="_images/tip_calc1.png"><img alt="_images/tip_calc1.png" src="_images/tip_calc1.png" style="width: 163.5px; height: 251.0px;" /></a>
<p>Lets create the IDE project settings.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sbt gen-idea
</pre></div>
</div>
<p>Next lauhch IntelliJ and click Open Project.  Navigate to the directory we created the tipCalcualtor app.
Click on the directory name, then click open. The IDE should open with the project enabled.</p>
</div>
<div class="section" id="creating-the-calculatorcore">
<h2><a class="toc-backref" href="#id4">Creating the CalculatorCore</a><a class="headerlink" href="#creating-the-calculatorcore" title="Permalink to this headline">¶</a></h2>
<p>Now we need to create a test file.  In the project window, expand the src directory.  Next expand the test directory and right click on the scala diretory. Select the Scala Class option.</p>
<a class="reference internal image-reference" href="_images/CalcSpecs.png"><img alt="_images/CalcSpecs.png" src="_images/CalcSpecs.png" style="width: 644.0px; height: 395.0px;" /></a>
<p>Now we need to add the folling lines to the scala test file we just created.</p>
<div class="highlight-scala"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">import</span> <span class="nn">org.scalatest.FunSpec</span>
<span class="k">import</span> <span class="nn">org.scalatest.matchers.ShouldMatchers</span>

<span class="k">class</span> <span class="nc">CalculatorSpecs</span> <span class="k">extends</span> <span class="nc">FunSpec</span> <span class="k">with</span> <span class="nc">ShouldMatchers</span> <span class="o">{</span>
  <span class="n">describe</span><span class="o">(</span><span class="s">&quot;a Tip Calculator&quot;</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Before we go and write the first test.  we need to create the basic object we are testing.</p>
<ol class="arabic simple">
<li>In the project window, expand the src directory.</li>
<li>Then expand the main directory.</li>
<li>Right click on the scala directory.</li>
<li>Select New &gt; Package...</li>
<li>Give the pckage the name models</li>
<li>Click OK</li>
<li>Right click on the models package we just created.</li>
<li>select New &gt; Scala Class...</li>
<li>Name the class CalculatorCore</li>
<li>Set the type to be Object.</li>
<li>Click OK</li>
</ol>
<div class="highlight-scala"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre>    <span class="k">package</span> <span class="nn">com.cajuncode.tipcalculator.models</span>

    <span class="k">object</span> <span class="nc">CalculatorCore</span> <span class="o">{</span>

    <span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Now that we have an object to test, lets create our first test.  Open the CalculatorSpecs file and add the following lines inside the describe block.</p>
<div class="highlight-scala"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">it</span><span class="o">(</span><span class="s">&quot;should calculate the tip of 100.00&quot;</span><span class="o">){</span>
  <span class="k">val</span> <span class="n">calc</span> <span class="k">=</span> <span class="nc">CalculatorCore</span>
  <span class="k">var</span> <span class="n">result</span> <span class="k">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">getTip</span><span class="o">(</span><span class="mf">100.00</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
  <span class="n">result</span> <span class="n">should</span> <span class="n">equal</span><span class="o">(</span><span class="mf">10.00</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Ok lets run the test</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$sbt</span> <span class="nb">test</span>
<span class="o">[</span>info<span class="o">]</span> Compiling 2 Scala sources to /Users/alley/Projects/scala_android_book/code/tip-calculator/target/scala-2.10/test-classes...
<span class="o">[</span>error<span class="o">]</span> /Users/alley/Projects/scala_android_book/code/tip-calculator/src/test/scala/CalculatorSpecs.scala:9: value getTip is not a member of object com.cajuncode.tipcalculator.models.CalculatorCore
<span class="o">[</span>error<span class="o">]</span>       var <span class="nv">result</span> <span class="o">=</span> calc.getTip<span class="o">(</span>100.00, 10<span class="o">)</span>
<span class="o">[</span>error<span class="o">]</span>                         ^
<span class="o">[</span>error<span class="o">]</span> one error found
<span class="o">[</span>error<span class="o">]</span> <span class="o">(</span>TipCalculator/test:compile<span class="o">)</span> Compilation failed
<span class="o">[</span>error<span class="o">]</span> Total <span class="nb">time</span>: 21 s, completed Apr 17, 2013 12:31:53 AM
</pre></div>
</div>
<p>This tells us that the method needs to be defined.  So that is where we are going to start.</p>
<div class="highlight-scala"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="n">getTip</span><span class="o">(</span><span class="n">bill</span><span class="k">:</span><span class="kt">Double</span><span class="o">,</span> <span class="n">tip_percentage</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span><span class="kt">Double</span> <span class="o">=</span> <span class="o">{</span>
   <span class="mf">0.00</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>run the test again.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sbt <span class="nb">test</span>
<span class="o">[</span>info<span class="o">]</span> Loading global plugins from /Users/alley/.sbt/plugins
<span class="o">[</span>info<span class="o">]</span> Loading project definition from /Users/alley/Projects/scala_android_book/code/tip-calculator/project
<span class="o">[</span>info<span class="o">]</span> Set current project to TipCalculator <span class="o">(</span>in build file:/Users/alley/Projects/scala_android_book/code/tip-calculator/<span class="o">)</span>
<span class="o">[</span>info<span class="o">]</span> Wrote /Users/alley/Projects/scala_android_book/code/tip-calculator/target/scala-2.10/src_managed/main/scala/com/cajuncode/tipcalculator/TR.scala
<span class="o">[</span>info<span class="o">]</span> Compiling 1 Scala <span class="nb">source </span>to /Users/alley/Projects/scala_android_book/code/tip-calculator/target/scala-2.10/classes...
<span class="o">[</span>info<span class="o">]</span> Compiling 2 Scala sources to /Users/alley/Projects/scala_android_book/code/tip-calculator/target/scala-2.10/test-classes...
<span class="o">[</span>info<span class="o">]</span> Specs:
<span class="o">[</span>info<span class="o">]</span> a spec
<span class="o">[</span>info<span class="o">]</span> - should <span class="k">do </span>something
<span class="o">[</span>info<span class="o">]</span> CalculatorSpecs:
<span class="o">[</span>info<span class="o">]</span> a Tip Calculator
<span class="o">[</span>info<span class="o">]</span> - should calculate the tip of 100.00 *** FAILED ***
<span class="o">[</span>info<span class="o">]</span>   0.0 did not equal 10.0 <span class="o">(</span>CalculatorSpecs.scala:10<span class="o">)</span>
<span class="o">[</span>error<span class="o">]</span> Failed: : Total 2, Failed 1, Errors 0, Passed 1, Skipped 0
<span class="o">[</span>error<span class="o">]</span> Failed tests:
<span class="o">[</span>error<span class="o">]</span>      CalculatorSpecs
</pre></div>
</div>
<p>Lets refactor the method to return a live value.  Change the getTip method to look like below.</p>
<div class="highlight-scala"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="n">getTip</span><span class="o">(</span><span class="n">bill</span><span class="k">:</span><span class="kt">Double</span><span class="o">,</span> <span class="n">tip_percentage</span><span class="k">:</span><span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="o">(</span><span class="n">bill</span> <span class="o">*</span> <span class="o">(</span><span class="n">tip_percentage</span> <span class="o">/</span> <span class="mf">100.0</span><span class="o">))</span>
</pre></div>
</td></tr></table></div>
<p>Now lets run the test again.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sbt <span class="nb">test</span>
<span class="o">[</span>info<span class="o">]</span> Loading global plugins from /Users/alley/.sbt/plugins
<span class="o">[</span>info<span class="o">]</span> Loading project definition from /Users/alley/Projects/scala_android_book/code/tip-calculator/project
<span class="o">[</span>info<span class="o">]</span> Set current project to TipCalculator <span class="o">(</span>in build file:/Users/alley/Projects/scala_android_book/code/tip-calculator/<span class="o">)</span>
<span class="o">[</span>info<span class="o">]</span> Wrote /Users/alley/Projects/scala_android_book/code/tip-calculator/target/scala-2.10/src_managed/main/scala/com/cajuncode/tipcalculator/TR.scala
<span class="o">[</span>info<span class="o">]</span> Compiling 1 Scala <span class="nb">source </span>to /Users/alley/Projects/scala_android_book/code/tip-calculator/target/scala-2.10/classes...
<span class="o">[</span>info<span class="o">]</span> Specs:
<span class="o">[</span>info<span class="o">]</span> a spec
<span class="o">[</span>info<span class="o">]</span> - should <span class="k">do </span>something
<span class="o">[</span>info<span class="o">]</span> CalculatorSpecs:
<span class="o">[</span>info<span class="o">]</span> a Tip Calculator
<span class="o">[</span>info<span class="o">]</span> - should calculate the tip of 100.00
<span class="o">[</span>info<span class="o">]</span> Passed: : Total 2, Failed 0, Errors 0, Passed 2, Skipped 0
<span class="o">[</span>success<span class="o">]</span> Total <span class="nb">time</span>: 4 s, completed Apr 17, 2013 1:00:00 AM
</pre></div>
</div>
<p>And we have passing our first passing test.  So lets create one more test.</p>
<p>In the feature story we have at the start of the chapter,  We use a 50 dollar balance with a 17% tip so lets write that as a test.</p>
<p>Open the CalculatorSpecs file and add this below the closing bracket after the it.</p>
<div class="highlight-scala"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">it</span><span class="o">(</span><span class="s">&quot;should calculate the tip of 50 dollars at 17% to equal 8.5&quot;</span><span class="o">){</span>
  <span class="k">val</span> <span class="n">calc</span> <span class="k">=</span> <span class="nc">CalculatorCore</span>
  <span class="k">var</span> <span class="n">result</span> <span class="k">=</span> <span class="n">calc</span><span class="o">.</span><span class="n">getTip</span><span class="o">(</span><span class="mf">50.00</span><span class="o">,</span> <span class="mi">17</span><span class="o">)</span>
  <span class="n">result</span> <span class="n">should</span> <span class="n">equal</span><span class="o">(</span><span class="mf">8.5</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Now run the test.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sbt <span class="nb">test</span>
<span class="o">[</span>info<span class="o">]</span> Loading global plugins from /Users/alley/.sbt/plugins
<span class="o">[</span>info<span class="o">]</span> Loading project definition from /Users/alley/Projects/scala_android/code/tip-calculator/project
<span class="o">[</span>info<span class="o">]</span> Set current project to TipCalculator <span class="o">(</span>in build file:/Users/alley/Projects/scala_android/code/tip-calculator/<span class="o">)</span>
<span class="o">[</span>info<span class="o">]</span> Wrote /Users/alley/Projects/scala_android/code/tip-calculator/target/scala-2.10/src_managed/main/scala/com/cajuncode/tipcalculator/TR.scala
<span class="o">[</span>info<span class="o">]</span> Compiling 3 Scala sources and 1 Java <span class="nb">source </span>to /Users/alley/Projects/scala_android/code/tip-calculator/target/scala-2.10/classes...
<span class="o">[</span>warn<span class="o">]</span> there were 4 feature warnings; re-run with -feature <span class="k">for </span>details
<span class="o">[</span>warn<span class="o">]</span> one warning found
<span class="o">[</span>info<span class="o">]</span> Compiling 2 Scala sources to /Users/alley/Projects/scala_android/code/tip-calculator/target/scala-2.10/test-classes...
<span class="o">[</span>info<span class="o">]</span> Specs:
<span class="o">[</span>info<span class="o">]</span> a spec
<span class="o">[</span>info<span class="o">]</span> - should <span class="k">do </span>something
<span class="o">[</span>info<span class="o">]</span> CalculatorSpecs:
<span class="o">[</span>info<span class="o">]</span> a Tip Calculator
<span class="o">[</span>info<span class="o">]</span> - should calculate the tip of 100.00
<span class="o">[</span>info<span class="o">]</span> - should calculate the tip of 50 dollars at 17% to equal 8.5
<span class="o">[</span>info<span class="o">]</span> Passed: : Total 3, Failed 0, Errors 0, Passed 3, Skipped 0
<span class="o">[</span>success<span class="o">]</span> Total <span class="nb">time</span>: 20 s, completed Apr 17, 2013 9:03:06 AM
</pre></div>
</div>
<p>Now that we know the calculation works, Time to work on the UI.</p>
</div>
<div class="section" id="designing-the-user-interface">
<h2><a class="toc-backref" href="#id5">Designing the User Interface</a><a class="headerlink" href="#designing-the-user-interface" title="Permalink to this headline">¶</a></h2>
<p>Open the main.xml file under src/main/res/layout.  When the file first opens in design mode. you see a palette on the right side of the screen.  On the left side, The component tree shows all the components in the layout.  Also on the left side is the property window.  This is where you will change properties such as text and values for the components.</p>
<a class="reference internal image-reference" href="_images/tc_main_inital.png"><img alt="_images/tc_main_inital.png" src="_images/tc_main_inital.png" style="width: 687.0px; height: 437.0px;" /></a>
<p>Here is the xml use in the view.  it would be a lot of steps if we built the UI though the designer.</p>
<div class="highlight-xml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>

<span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
       <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
       <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span> <span class="na">android:orientation=</span><span class="s">&quot;vertical&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;EditText</span>
            <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
            <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
            <span class="na">android:id=</span><span class="s">&quot;@+id/billAmount&quot;</span> <span class="na">android:inputType=</span><span class="s">&quot;numberDecimal&quot;</span> <span class="na">android:hint=</span><span class="s">&quot;Enter the amount of the Bill&quot;</span>
            <span class="na">android:gravity=</span><span class="s">&quot;right&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;LinearLayout</span>
            <span class="na">android:orientation=</span><span class="s">&quot;horizontal&quot;</span>
            <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
            <span class="na">android:layout_height=</span><span class="s">&quot;fill_parent&quot;</span> <span class="na">android:paddingBottom=</span><span class="s">&quot;10dp&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;SeekBar</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/percent&quot;</span> <span class="na">android:layout_weight=</span><span class="s">&quot;3&quot;</span> <span class="na">android:paddingRight=</span><span class="s">&quot;10dp&quot;</span> <span class="na">android:max=</span><span class="s">&quot;100&quot;</span>
                <span class="na">android:progress=</span><span class="s">&quot;17&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;TextView</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:text=</span><span class="s">&quot;17%&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/txtPercent&quot;</span> <span class="na">android:layout_gravity=</span><span class="s">&quot;center&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/LinearLayout&gt;</span>
    <span class="nt">&lt;LinearLayout</span>
            <span class="na">android:orientation=</span><span class="s">&quot;horizontal&quot;</span>
            <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
            <span class="na">android:layout_height=</span><span class="s">&quot;fill_parent&quot;</span> <span class="na">android:paddingBottom=</span><span class="s">&quot;10dp&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;TextView</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:text=</span><span class="s">&quot;Tip Amount:&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/lbTipAmount&quot;</span> <span class="na">android:layout_weight=</span><span class="s">&quot;2&quot;</span> <span class="na">android:paddingLeft=</span><span class="s">&quot;3dp&quot;</span>
                <span class="na">android:password=</span><span class="s">&quot;false&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;TextView</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/tipAmount&quot;</span> <span class="na">android:layout_weight=</span><span class="s">&quot;2&quot;</span> <span class="na">android:gravity=</span><span class="s">&quot;right&quot;</span>
                <span class="na">android:paddingRight=</span><span class="s">&quot;10dp&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/LinearLayout&gt;</span>
    <span class="nt">&lt;LinearLayout</span>
            <span class="na">android:orientation=</span><span class="s">&quot;horizontal&quot;</span>
            <span class="na">android:layout_width=</span><span class="s">&quot;fill_parent&quot;</span>
            <span class="na">android:layout_height=</span><span class="s">&quot;fill_parent&quot;</span> <span class="na">android:paddingBottom=</span><span class="s">&quot;10dp&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;TextView</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:text=</span><span class="s">&quot;Total Amount: &quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/lbTotalAmount&quot;</span> <span class="na">android:layout_weight=</span><span class="s">&quot;2&quot;</span> <span class="na">android:paddingLeft=</span><span class="s">&quot;3dp&quot;</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;TextView</span>
                <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
                <span class="na">android:id=</span><span class="s">&quot;@+id/totalAmount&quot;</span> <span class="na">android:layout_weight=</span><span class="s">&quot;2&quot;</span> <span class="na">android:gravity=</span><span class="s">&quot;right&quot;</span>
                <span class="na">android:paddingRight=</span><span class="s">&quot;10dp&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/LinearLayout&gt;</span>
<span class="nt">&lt;/LinearLayout&gt;</span>
</pre></div>
</td></tr></table></div>
<p>With the UI Layed out this it what it looks like in the designer.</p>
<a class="reference internal image-reference" href="_images/tc_main_designed.png"><img alt="_images/tc_main_designed.png" src="_images/tc_main_designed.png" style="width: 687.0px; height: 437.0px;" /></a>
<p>OK we are getting close enough to try and running the app and see it.  But first we need to fix a
piece of code so the app will launch.  Under src/main/scala/MainActivity.scala, we need to comment out
the findView call on line 11 like so.</p>
<div class="highlight-scala"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">package</span> <span class="nn">com.cajuncode.tipcalculator</span>

<span class="k">import</span> <span class="nn">_root_.android.app.Activity</span>
<span class="k">import</span> <span class="nn">_root_.android.os.Bundle</span>

<span class="k">class</span> <span class="nc">MainActivity</span> <span class="k">extends</span> <span class="nc">Activity</span> <span class="k">with</span> <span class="nc">TypedActivity</span> <span class="o">{</span>
  <span class="k">override</span> <span class="k">def</span> <span class="n">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="k">:</span> <span class="kt">Bundle</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">super</span><span class="o">.</span><span class="n">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">)</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">main</span><span class="o">)</span>

    <span class="c1">//findView(TR.textview).setText(&quot;hello, world!&quot;)</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>Before we can run the app we need to start the emulator</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>emulator -avd ics
</pre></div>
</div>
<p>This will start the emulator and load the ics avd.</p>
<p>With the emulator started we want to push our application to the emulator.  On a different terminal window or command prompt run the following command.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sbt android:start-emulator
<span class="o">[</span>info<span class="o">]</span> Loading global plugins from /Users/alley/.sbt/plugins
<span class="o">[</span>info<span class="o">]</span> Loading project definition from /Users/alley/Projects/scala_android/code/tip-calculator/project
<span class="o">[</span>info<span class="o">]</span> Set current project to TipCalculator <span class="o">(</span>in build file:/Users/alley/Projects/scala_android/code/tip-calculator/<span class="o">)</span>
<span class="o">[</span>info<span class="o">]</span> Wrote /Users/alley/Projects/scala_android/code/tip-calculator/target/scala-2.10/src_managed/main/scala/com/cajuncode/tipcalculator/TR.scala
ProGuard, version 4.6
ProGuard is released under the GNU General Public License. You therefore
must ensure that programs that link to it <span class="o">(</span>scala, ...<span class="o">)</span>
carry the GNU General Public License as well. Alternatively, you can
apply <span class="k">for </span>an exception with the author of ProGuard.
The output seems up to date
    <span class="o">(</span>skipping file <span class="s1">&#39;.gitkeep&#39;</span> due to ANDROID_AAPT_IGNORE pattern <span class="s1">&#39;.*&#39;</span><span class="o">)</span>
<span class="o">[</span>info<span class="o">]</span> Packaging /Users/alley/Projects/scala_android/code/tip-calculator/target/tipcalculator-0.1.apk
<span class="o">[</span>info<span class="o">]</span>       pkg: /data/local/tmp/tipcalculator-0.1.apk
<span class="o">[</span>info<span class="o">]</span> Success
<span class="o">[</span>info<span class="o">]</span> 1847 KB/s <span class="o">(</span>181817 bytes in 0.096s<span class="o">)</span>
<span class="o">[</span>info<span class="o">]</span> Starting: Intent <span class="o">{</span> <span class="nv">act</span><span class="o">=</span>android.intent.action.MAIN <span class="nv">cmp</span><span class="o">=</span>com.cajuncode.tipcalculator/.MainActivity <span class="o">}</span>
<span class="o">[</span>success<span class="o">]</span> Total <span class="nb">time</span>: 17 s, completed Apr 17, 2013 3:26:29 PM
</pre></div>
</div>
<p>This packages the application into an apk and deploys it to the emulator.  Rerunning this command will redeploy the app.  It is a good practice not to restart the emulator each deployment due to is painful boot time.</p>
<a class="reference internal image-reference" href="_images/tc_emulator_1.png"><img alt="_images/tc_emulator_1.png" src="_images/tc_emulator_1.png" style="width: 386.0px; height: 437.5px;" /></a>
<p>Now we see what we&#8217;ve built, It&#8217;s time to bind the components to the views.
Go back to the MainActivity</p>
<div class="highlight-scala"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="o">...</span>
<span class="k">import</span> <span class="nn">android.widget.</span><span class="o">{</span><span class="nc">TextView</span><span class="o">,</span> <span class="nc">SeekBar</span><span class="o">,</span> <span class="nc">EditText</span><span class="o">}</span>

<span class="k">class</span> <span class="nc">MainActivity</span> <span class="k">extends</span> <span class="nc">Activity</span> <span class="k">with</span> <span class="nc">TypedActivity</span> <span class="o">{</span>

  <span class="k">private</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">bill</span><span class="k">:</span><span class="kt">EditText</span> <span class="o">=</span> <span class="n">findView</span><span class="o">(</span><span class="nc">TR</span><span class="o">.</span><span class="n">billAmount</span><span class="o">)</span>
  <span class="k">private</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">percentage</span><span class="k">:</span><span class="kt">SeekBar</span> <span class="o">=</span> <span class="n">findView</span><span class="o">(</span><span class="nc">TR</span><span class="o">.</span><span class="n">percent</span><span class="o">)</span>
  <span class="k">private</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">percentText</span><span class="k">:</span><span class="kt">TextView</span> <span class="o">=</span> <span class="n">findView</span><span class="o">(</span><span class="nc">TR</span><span class="o">.</span><span class="n">txtPercent</span><span class="o">)</span>
  <span class="k">private</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">tipAmount</span><span class="k">:</span><span class="kt">TextView</span> <span class="o">=</span> <span class="n">findView</span><span class="o">(</span><span class="nc">TR</span><span class="o">.</span><span class="n">tipAmount</span><span class="o">)</span>
  <span class="k">private</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">totalAmount</span><span class="k">:</span><span class="kt">TextView</span> <span class="o">=</span> <span class="n">findView</span><span class="o">(</span><span class="nc">TR</span><span class="o">.</span><span class="n">totalAmount</span><span class="o">)</span>

  <span class="o">...</span>
</pre></div>
</td></tr></table></div>
<p>Lets add variables to point to the components we want to bind. findView is a TypedActivity method to add a helper
to do object casting.</p>
<p>With the variables bound we can turn our attention to onCreate.  This method is run when the Activity is first started.
An Activity is what android calls a window that is to be displayed.</p>
<div class="highlight-scala"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">override</span> <span class="k">def</span> <span class="n">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="k">:</span> <span class="kt">Bundle</span><span class="o">)</span> <span class="o">{</span>
  <span class="k">super</span><span class="o">.</span><span class="n">onCreate</span><span class="o">(</span><span class="n">bundle</span><span class="o">)</span>
  <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">main</span><span class="o">)</span>

  <span class="n">bill</span><span class="o">.</span><span class="n">addTextChangedListener</span><span class="o">(</span> <span class="k">new</span> <span class="nc">TextWatcher</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">beforeTextChanged</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">CharSequence</span><span class="o">,</span> <span class="n">start</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">count</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">after</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{}</span>

    <span class="k">def</span> <span class="n">onTextChanged</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">CharSequence</span><span class="o">,</span> <span class="n">start</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">before</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">count</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="o">{}</span>

    <span class="k">def</span> <span class="n">afterTextChanged</span><span class="o">(</span><span class="n">value</span><span class="k">:</span> <span class="kt">Editable</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">updateTip</span><span class="o">()</span>
    <span class="o">}</span>
  <span class="o">}</span> <span class="o">)</span>
  <span class="n">percentage</span><span class="o">.</span><span class="n">setOnSeekBarChangeListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">OnSeekBarChangeListener</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">onProgressChanged</span><span class="o">(</span><span class="n">seekbar</span><span class="k">:</span> <span class="kt">SeekBar</span><span class="o">,</span> <span class="n">progress</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span> <span class="n">fromUser</span><span class="k">:</span> <span class="kt">Boolean</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">updateTip</span><span class="o">()</span>
      <span class="n">percentText</span><span class="o">.</span><span class="n">setText</span><span class="o">(</span><span class="n">progress</span><span class="o">.</span><span class="n">toString</span> <span class="o">+</span> <span class="s">&quot;%&quot;</span><span class="o">)</span>
    <span class="o">}</span>

    <span class="k">def</span> <span class="n">onStopTrackingTouch</span><span class="o">(</span><span class="n">seekbar</span><span class="k">:</span> <span class="kt">SeekBar</span><span class="o">)</span> <span class="o">{}</span>

    <span class="k">def</span> <span class="n">onStartTrackingTouch</span><span class="o">(</span><span class="n">seekbar</span><span class="k">:</span> <span class="kt">SeekBar</span><span class="o">)</span> <span class="o">{}</span>
  <span class="o">})</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>In this method we use inner classes to implement two listeners.  Each Listener is a contract that states that a set of methods
will be created.  This is offten called an Interface.  The only real events we care about listening for is the after text has
changed in the billAmount edit box and when the seek bar has changed.  For both of these events we want to call updateTip method.</p>
<div class="highlight-scala"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="n">updateTip</span><span class="o">(){</span>
  <span class="k">val</span> <span class="n">billText</span><span class="k">:</span><span class="kt">String</span> <span class="o">=</span> <span class="n">bill</span><span class="o">.</span><span class="n">getText</span><span class="o">().</span><span class="n">toString</span>
  <span class="k">val</span> <span class="n">amount</span> <span class="k">=</span> <span class="n">convert</span><span class="o">(</span><span class="n">billText</span><span class="o">)</span>

  <span class="k">val</span> <span class="n">tip</span> <span class="k">=</span> <span class="nc">CalculatorCore</span><span class="o">.</span><span class="n">getTip</span><span class="o">(</span><span class="n">amount</span><span class="o">,</span> <span class="n">percentage</span><span class="o">.</span><span class="n">getProgress</span><span class="o">)</span>
  <span class="n">tipAmount</span><span class="o">.</span><span class="n">setText</span><span class="o">(</span><span class="n">formatDecimal</span><span class="o">(</span><span class="n">tip</span><span class="o">))</span>
  <span class="n">totalAmount</span><span class="o">.</span><span class="n">setText</span><span class="o">(</span><span class="n">formatDecimal</span><span class="o">(</span><span class="n">amount</span> <span class="o">+</span> <span class="n">tip</span><span class="o">))</span>
<span class="o">}</span>
<span class="k">def</span> <span class="n">convert</span><span class="o">(</span><span class="n">value</span><span class="k">:</span><span class="kt">String</span><span class="o">)</span><span class="k">:</span><span class="kt">Double</span> <span class="o">=</span> <span class="k">if</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="n">isEmpty</span><span class="o">)</span> <span class="mi">00</span> <span class="k">else</span> <span class="n">value</span><span class="o">.</span><span class="n">toDouble</span>
<span class="k">def</span> <span class="n">formatDecimal</span><span class="o">(</span><span class="n">value</span><span class="k">:</span><span class="kt">Double</span><span class="o">)</span><span class="k">:</span><span class="kt">String</span> <span class="o">=</span> <span class="s">&quot;%1.2f&quot;</span> <span class="n">format</span> <span class="n">value</span>
</pre></div>
</td></tr></table></div>
<p>With updateTip defined all we do is read in the value from the edit box and convert it to a string. Next we will convert the text to a
double precision floating point number or double.  This conversion has been wrapped into a function to handle the case of updating the
field to empty.  Then using the model we created, calculated the tip amount. Now all that is left is to display the tip and the total back to the user.  The formatDecimal just formats the amounts calculated to a currency format with two decimal places.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>java.lang.NoSuchMethodError: scala.collection.immutable.StringLike.toString</p>
<p>As I was working on this. I stumbled upon a bug in Scala with Proguard. When proguard runs trimming the code it removes a method
necessary for the convertion to Double from string to work. To fix this you need to make a change to the proguard config in
the Build.scala file under project.  Under object General add a new val proguardOptions with the keep class string.  Then add that to
the fullAndroidSettings as seen below. This is a known bug in Scala 2.10.0</p>
<div class="last highlight-scala"><div class="highlight"><pre><span class="k">val</span> <span class="n">proguardOptions</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">(</span>
  <span class="n">proguardOption</span> <span class="n">in</span> <span class="nc">Android</span> <span class="o">:=</span> <span class="s">&quot;-keep class scala.collection.SeqLike {\n    public protected *;\n}&quot;</span>
 <span class="o">)</span>
<span class="k">lazy</span> <span class="k">val</span> <span class="n">fullAndroidSettings</span> <span class="k">=</span>
  <span class="nc">General</span><span class="o">.</span><span class="n">settings</span> <span class="o">++</span>
  <span class="nc">AndroidProject</span><span class="o">.</span><span class="n">androidSettings</span> <span class="o">++</span>
  <span class="nc">TypedResources</span><span class="o">.</span><span class="n">settings</span> <span class="o">++</span>
  <span class="n">proguardSettings</span> <span class="o">++</span>
  <span class="n">proguardOptions</span> <span class="o">++</span>
  <span class="nc">AndroidManifestGenerator</span><span class="o">.</span><span class="n">settings</span> <span class="o">++</span>
  <span class="nc">AndroidMarketPublish</span><span class="o">.</span><span class="n">settings</span> <span class="o">++</span> <span class="nc">Seq</span> <span class="o">(</span>
    <span class="n">keyalias</span> <span class="n">in</span> <span class="nc">Android</span> <span class="o">:=</span> <span class="s">&quot;change-me&quot;</span><span class="o">,</span>
    <span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">&quot;org.scalatest&quot;</span> <span class="o">%%</span> <span class="s">&quot;scalatest&quot;</span> <span class="o">%</span> <span class="s">&quot;1.9.1&quot;</span> <span class="o">%</span> <span class="s">&quot;test&quot;</span>
  <span class="o">)</span>
</pre></div>
</div>
</div>
<p>Now lets run the app again.  with the emulator running type the following command.</p>
<div class="highlight-bash"><div class="highlight"><pre><span class="nv">$ </span>sbt android:start-emulator
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/tc_emulator_complete.png"><img alt="_images/tc_emulator_complete.png" src="_images/tc_emulator_complete.png" style="width: 386.0px; height: 437.5px;" /></a>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tip Calculator</a><ul>
<li><a class="reference internal" href="#feature-scenario">Feature Scenario</a></li>
<li><a class="reference internal" href="#project-setup">Project Setup</a></li>
<li><a class="reference internal" href="#creating-the-calculatorcore">Creating the CalculatorCore</a></li>
<li><a class="reference internal" href="#designing-the-user-interface">Designing the User Interface</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="setup.html"
                        title="previous chapter">Setting Up</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tip_calc.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="setup.html" title="Setting Up"
             >previous</a> |</li>
        <li><a href="index.html">Mobile Development with Scala</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Allan Davis.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>